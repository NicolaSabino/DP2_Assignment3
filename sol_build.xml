<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="build-service" name="RNS-SOL3">
	<description>
			Script for RNS Assignment 3 solution
	</description>
	
	<!-- properties -->
	<property name="custom.dir" location="${basedir}/custom"/>
	<property name="build.dir" location="${basedir}/build"/>
	<property name="schema.dir" location="${basedir}/xsd" />
	<property name="gen.src" location="${basedir}/gen-src"/>
	<property name="pack1" value="it.polito.dp2.RNS.sol1.jaxb"/>
	<property name="pack2" value="it.polito.dp2.RNS.rest.jaxb"/>
	
	<!-- The classpath to be used for compilation of the solution -->
	<path id="RNS.classpath">
		<pathelement location="${lib.dir}/RNS.jar" />
	</path>

	
	<!-- generate java classes from rnsInfo.xsd -->
	<target name="generate_lab1">
		<echo message="generate java classes from rnsInfo.xsd " />
		<mkdir dir="${basedir}/gen-src"/>
		<exec executable="xjc" failonerror="true" >
			<arg line="-d ${gen.src} -p ${pack1} ${schema.dir}/rnsInfo.xsd"/>
		</exec>
	</target>
	
	<!-- generate java classes from DataTypes.xsd -->
	<target name="generate_lab2">
		<echo message="generate java classes from DataTypes.xsd" />
		<mkdir dir="${basedir}/gen-src"/>
		<exec executable="xjc">
			<arg line="-d gen-src -p ${pack2} ${custom.dir}/DataTypes.xsd"/>
		</exec>
	</target>
	
	<target name="build-service"  depends="myclean,generate_lab1, generate_lab2">
		<echo message="Compiling ${pack1} and ${pack2}..." />
		<mkdir dir="${build.dir}"/>
		<javac destdir="build" debug="on" includeantruntime="false">
			<src path="gen-src" />
			<classpath refid="RNS.classpath"/>
		</javac>
		
		<echo message="Compiling the java source files..." />
		<javac destdir="bin" debug="on" includeantruntime="false">
			<src path="src" />
			<classpath refid="RNS.classpath"/>
		</javac>
		
		<echo message="copy from bin to build" />
		<copy toDir="${build.dir}" overwrite="true">
			<fileset dir="bin"/>
		</copy>
		
	</target>
	
	<!-- Target clean -->
	<target name="myclean" description="Clean all">
		<delete dir="${build.dir}" />
		<delete dir="${gen.src}"/>
	</target>

</project>
